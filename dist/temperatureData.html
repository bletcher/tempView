<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Temperature Data Viewer</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="preload" as="style" href="./_npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="./_npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_import/components/temperatureDataPlots.3c80187b.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_import/components/variables.3a13d9f2.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.14/_esm.js">
<link rel="modulepreload" href="./_node/regression@2.0.1/index.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/apache-arrow@16.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/parquet-wasm@0.6.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/leaflet@1.9.4/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/tslib@2.6.2/_esm.js">
<link rel="modulepreload" href="./_npm/flatbuffers@24.3.25/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/VA_site_info_DL.csv", {"name":"./data/VA_site_info_DL.csv","mimeType":"text/csv","path":"./_file/data/VA_site_info_DL.61104172.csv","lastModified":1716911604828});
registerFile("./data/dt.csv", {"name":"./data/dt.csv","mimeType":"text/csv","path":"./_file/data/dt.51be9f7e.csv","lastModified":1716911476353});
registerFile("./data/dtHOUR.csv", {"name":"./data/dtHOUR.csv","mimeType":"text/csv","path":"./_file/data/dtHOUR.9029e959.csv","lastModified":1716911580061});
registerFile("./data/dtHOUR_ampPhase.csv", {"name":"./data/dtHOUR_ampPhase.csv","mimeType":"text/csv","path":"./_file/data/dtHOUR_ampPhase.178de193.csv","lastModified":1716911584036});
registerFile("./data/dtHOUR_params_pred.csv", {"name":"./data/dtHOUR_params_pred.csv","mimeType":"text/csv","path":"./_file/data/dtHOUR_params_pred.7571faf9.csv","lastModified":1716911599646});
registerFile("./data/dtYDAY.csv", {"name":"./data/dtYDAY.csv","mimeType":"text/csv","path":"./_file/data/dtYDAY.fba657a0.csv","lastModified":1716911491942});
registerFile("./data/dtYDAY_Month.csv", {"name":"./data/dtYDAY_Month.csv","mimeType":"text/csv","path":"./_file/data/dtYDAY_Month.bebbaf51.csv","lastModified":1716911518312});
registerFile("./data/dtYDAY_Week.csv", {"name":"./data/dtYDAY_Week.csv","mimeType":"text/csv","path":"./_file/data/dtYDAY_Week.c0fa0dbe.csv","lastModified":1716911505465});
registerFile("./data/samples.parquet", {"name":"./data/samples.parquet","path":"./_file/data/samples.cb7ab655.parquet","lastModified":1716906520095});

define({id: "48a9579a", outputs: ["plotTimeSeries","plotAirWater","plotWaterDischarge","plotCurve","plotCurveHover","plotPhaseAmp","plotPhaseAmpXY","d3"], body: async () => {
const [{plotTimeSeries, plotAirWater, plotWaterDischarge, plotCurve, plotCurveHover, plotPhaseAmp, plotPhaseAmpXY}, d3] = await Promise.all([import("./_import/components/temperatureDataPlots.3c80187b.js"), import("./_npm/d3@7.9.0/_esm.js")]);
//import {addMap} from "./components/raw_data_map.js";
//import {interval} from 'https://observablehq.com/@mootari/range-slider';
//import { ML } from 'ml';
//import {Mutable} from "@observablehq/stdlib";
//import * as tidyjs from "npm:tidyjs";
//import {DuckDBClient} from "npm:@observablehq/duckdb";
return {plotTimeSeries,plotAirWater,plotWaterDischarge,plotCurve,plotCurveHover,plotPhaseAmp,plotPhaseAmpXY,d3};
}});

define({id: "a6c004ae", outputs: ["dt","dtYDAY","dtYDAY_Week","dtYDAY_Month","dtHOUR","dtHOUR_ampPhase","dtHOUR_params_pred","VA_data"], body: async () => {
const [{dt, dtYDAY, dtYDAY_Week, dtYDAY_Month, dtHOUR, dtHOUR_ampPhase, dtHOUR_params_pred}, {VA_data}] = await Promise.all([import("./_import/components/variables.3a13d9f2.js"), import("./_import/components/variables.3a13d9f2.js")]);


return {dt,dtYDAY,dtYDAY_Week,dtYDAY_Month,dtHOUR,dtHOUR_ampPhase,dtHOUR_params_pred,VA_data};
}});

define({id: "58d644e3", inputs: ["dt"], outputs: ["initialSite"], body: (dt) => {
const initialSite = [...new Set(dt.map(d => d.siteID))].sort()[0];//"PA_01FL";
return {initialSite};
}});

define({id: "a0e1eeed", inputs: ["display","initialSite"], body: (display,initialSite) => {
display(initialSite)
}});

define({id: "d44a9786", inline: true, inputs: ["dt","display"], body: async (dt,display) => {
display(await(
dt.length.toLocaleString("en-US")
))
}});

define({id: "18682c05", inline: true, inputs: ["dt","display"], body: async (dt,display) => {
display(await(
dt.filter(d => d.waterTemperature).length.toLocaleString("en-US")
))
}});

define({id: "29505eb2", inline: true, inputs: ["dt","display"], body: async (dt,display) => {
display(await(
dt.filter(d => d.airTemperature).length.toLocaleString("en-US")
))
}});

define({id: "51aeabef", inline: true, inputs: ["div_map1","display"], body: async (div_map1,display) => {
display(await(
div_map1
))
}});

define({id: "8d9103ef", inline: true, inputs: ["dtFiltered","display"], body: async (dtFiltered,display) => {
display(await(
dtFiltered.length.toLocaleString("en-US")
))
}});

define({id: "f60bbe75", inline: true, inputs: ["selectedSites","display"], body: async (selectedSites,display) => {
display(await(
selectedSites.length.toLocaleString("en-US")
))
}});

define({id: "bc09e940", inline: true, inputs: ["selectedYears","display"], body: async (selectedYears,display) => {
display(await(
selectedYears.length.toLocaleString("en-US")
))
}});

define({id: "8faaaddf", inline: true, inputs: ["selectedSeasons","display"], body: async (selectedSeasons,display) => {
display(await(
selectedSeasons.length.toLocaleString("en-US")
))
}});

define({id: "37f397cd", inputs: ["dt","Inputs","markersSelected","Generators","d3"], outputs: ["sites","selectSites","selectedSites","years","selectYears","selectedYears","seasons","selectSeasons","selectedSeasons","ydays","selectYdays","selectedYdays","groupSiteID","showAir","selectedShowAir","showWater","selectedShowWater","showAWLines","selectedShowAWLines","facetDaily","selectedFacetDaily","facetYearly","selectedFacetYearly","aggregators","selectAggregators","selectedAggregators","selectPValue","selectedPValue","selectRSAir","selectedRSAir","selectRSWater","selectedRSWater","selectAbsMinMax","selectedAbsMinMax"], body: (dt,Inputs,markersSelected,Generators,d3) => {
////////////
// Inputs //
////////////

//import { getInputs } from "/components/inputs.js";//,

const sites = [...new Set(dt.map(d => d.siteID))].sort();
const selectSites = Inputs.select(sites, {
  //value: sites[0],
  value: markersSelected, 
  multiple: 8, width: 100, label: "Select sites"});
const selectedSites = Generators.input(selectSites);

const years = [...new Set(dt.map(d => d.year))].sort();
const selectYears = (Inputs.select(years, {value: years, multiple: true, width: 80, label: "Select years"}));
const selectedYears = Generators.input(selectYears);

const seasons = ["Spring", "Summer", "Autumn", "Winter"];//[...new Set(dt.map(d => d.season))];
const selectSeasons = (Inputs.select(seasons, {value: seasons, multiple: true, width: 80, label: "Select seasons"}));
const selectedSeasons = Generators.input(selectSeasons);

const ydays = [...new Set(dt.map(d => d.yday))].sort((function(a, b) {
  return a - b;
}));
const selectYdays = (Inputs.select(ydays, {value: d3.range(1,366,60), multiple: true, width: 80, label: "Select day(s) of year"}));
const selectedYdays = Generators.input(selectYdays);

const groupSiteID = [...new Set(dt.map(d => d.siteID))].sort() // for the colorScale

const showAir = (Inputs.radio([true, false], {label: "Show Air Temp?", value: true}));
const selectedShowAir = Generators.input(showAir);

const showWater = (Inputs.radio([true, false], {label: "Show Water Temp?", value: true}));
const selectedShowWater = Generators.input(showWater);

const showAWLines = (Inputs.radio([true, false], {label: "Show lines?", value: true}));
const selectedShowAWLines = Generators.input(showAWLines);

const facetDaily = (Inputs.radio([true, false], {label: "Graph by day? [not yet implemented]", value: true}));
const selectedFacetDaily = Generators.input(facetDaily);

const facetYearly = (Inputs.radio([true, false], {label: "Facet by year?", value: false}));
const selectedFacetYearly = Generators.input(facetYearly);

const aggregators = ["Monthly", "Weekly", "Daily", "15 Minute"];
const selectAggregators = (Inputs.select(aggregators, {value: "Daily", multiple: false, width: 90, label: "Select aggregation level"}));
const selectedAggregators = Generators.input(selectAggregators);

const selectPValue = (Inputs.range([0.0001, 1], {value: 1, step: 0.01, width: 220, label: "Select minimum p-value of max(ABC)"}));
const selectedPValue = Generators.input(selectPValue);

const selectRSAir = (Inputs.range([0.01, 0.99], {value: 0.01, step: 0.01, width: 200, label: "Select minimum r-squared for air data fits"}));
const selectedRSAir = Generators.input(selectRSAir);

const selectRSWater = (Inputs.range([0.01, 0.99], {value: 0.01, step: 0.01, width: 200, label: "Select minimum r-squared for water data fits"}));
const selectedRSWater = Generators.input(selectRSWater);

const selectAbsMinMax = (Inputs.range([1, 25], {value: 25, step: 0.5, width: 200, label: "Select maximum absolute Phase Difference for plotting"}));
const selectedAbsMinMax = Generators.input(selectAbsMinMax);

return {sites,selectSites,selectedSites,years,selectYears,selectedYears,seasons,selectSeasons,selectedSeasons,ydays,selectYdays,selectedYdays,groupSiteID,showAir,selectedShowAir,showWater,selectedShowWater,showAWLines,selectedShowAWLines,facetDaily,selectedFacetDaily,facetYearly,selectedFacetYearly,aggregators,selectAggregators,selectedAggregators,selectPValue,selectedPValue,selectRSAir,selectedRSAir,selectRSWater,selectedRSWater,selectAbsMinMax,selectedAbsMinMax};
}});

define({id: "9cd086a7", inputs: ["dt","selectedSites","selectedYears","selectedSeasons","dtYDAY","dtYDAY_Week","dtYDAY_Month","dtHOUR","selectedYdays","dtHOUR_ampPhase","selectedPValue","selectedRSAir","selectedRSWater","selectedAbsMinMax"], outputs: ["filterBySiteID_year","filterBySiteID_year_season","filterBySiteID_year_yday","dtFiltered","dtYDAYFiltered","dtYDAY_Week_Filtered","dtYDAY_Month_Filtered","dtHOURFiltered","dtHOUR_ampPhase_Filtered"], body: async (dt,selectedSites,selectedYears,selectedSeasons,dtYDAY,dtYDAY_Week,dtYDAY_Month,dtHOUR,selectedYdays,dtHOUR_ampPhase,selectedPValue,selectedRSAir,selectedRSWater,selectedAbsMinMax) => {
const {filterBySiteID_year, filterBySiteID_year_season, filterBySiteID_year_yday} = await import("./_import/components/variables.3a13d9f2.js");
//////////////////////
// filtered objects //
//////////////////////


const dtFiltered = filterBySiteID_year_season(dt, selectedSites, selectedYears, selectedSeasons)
const dtYDAYFiltered = filterBySiteID_year_season(dtYDAY, selectedSites, selectedYears, selectedSeasons)
const dtYDAY_Week_Filtered = filterBySiteID_year_season(dtYDAY_Week, selectedSites, selectedYears, selectedSeasons)
const dtYDAY_Month_Filtered = filterBySiteID_year_season(dtYDAY_Month, selectedSites, selectedYears, selectedSeasons)

const dtHOURFiltered = filterBySiteID_year_yday(dtHOUR, selectedSites, selectedYears, selectedYdays)

const dtHOUR_ampPhase_Filtered = filterBySiteID_year_season(dtHOUR_ampPhase, selectedSites, selectedYears, selectedSeasons).filter(
  d => d.pMaxMax < selectedPValue &&
  d.rSquared_air > selectedRSAir &&
  d.rSquared_water > selectedRSWater &&
  Math.abs(d.phaseDiff) < selectedAbsMinMax 
)
return {filterBySiteID_year,filterBySiteID_year_season,filterBySiteID_year_yday,dtFiltered,dtYDAYFiltered,dtYDAY_Week_Filtered,dtYDAY_Month_Filtered,dtHOURFiltered,dtHOUR_ampPhase_Filtered};
}});

define({id: "f581ce20", inputs: ["display","L"], outputs: ["lat1","lon1","mag1","div_map1","map1","basemaps1","initialView1"], body: (display,L) => {
/////////
// Map //
/////////

  const lat1 = 38.5;
  const lon1 = -78.0;
  const mag1 = 9.2;

  const div_map1 = display(document.createElement("div"));
  div_map1.style = "height: 500px;";

  const map1 = L.map(div_map1)
    .setView([lat1, lon1], mag1);

  L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',   
      {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }
  )
  .addTo(map1);

  const basemaps1 = {
    USGS_hydro: L.tileLayer(
      'https://basemap.nationalmap.gov/arcgis/rest/services/USGSHydroCached/MapServer/tile/{z}/{y}/{x}',
      {
        attribution: '<a href="http://www.doi.gov">U.S. Department of the Interior</a> | <a href="http://www.usgs.gov">U.S. Geological Survey</a> | <a href="http://www.usgs.gov/laws/policies_notices.html">Policies</a>',
        maxZoom: 20
      }
    ),
    StreetView: L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',   
      {attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}
    ),
    Topography: L.tileLayer.wms(
      'http://ows.mundialis.de/services/service?',   
      {layers: 'TOPO-WMS'}
    ),
    Places: L.tileLayer.wms(
      'http://ows.mundialis.de/services/service?', 
      {layers: 'OSM-Overlay-WMS'}
    ),
    USGS_USImagery: L.tileLayer(
      'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}',
      {
        maxZoom: 20,
        attribution:
        'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>',
      }
    )
  };
  L.control.layers(basemaps1).addTo(map1);
  basemaps1.USGS_hydro.addTo(map1);

  // Store the initial map view
  const initialView1 = map1.getBounds();

  // Update the map view when the window is resized
  window.addEventListener('resize', function() {
    map1.fitBounds(initialView1);
  });
return {lat1,lon1,mag1,div_map1,map1,basemaps1,initialView1};
}});

define({id: "cacb8bdc", inputs: ["L","map1","VA_data","Mutable","initialSite"], outputs: ["addMarkers","addClickListenersToMarkers","updateMarkerStyles","markers","markersSelected"], body: (L,map1,VA_data,Mutable,initialSite) => {
/////////////////////////////////
// Add map markers and updates //
/////////////////////////////////

function addMarkers(dIn) {
  let markers = [];
  dIn.forEach(function(d) {
    let marker = L.circleMarker([d.lat, d.lon], {
      color: 'blue',
      fillColor: '#30f',
      fillOpacity: 0.5,
      radius: 10
    }).addTo(map1);

    // Add a 'selected' property to the marker
    marker.selected = false;
    marker.siteID = d.siteID;

    markers.push(marker);
  });
  return markers;
}

function addClickListenersToMarkers(markers) {
  markers.forEach(function(marker) {
    // Add a click event listener to the marker
    marker.on('click', function() {
      // Toggle the 'selected' property
      this.selected = !this.selected;

      markersSelected.value = markers.filter(d => d.selected).map(d => d.siteID)
      // Update the marker styles
      updateMarkerStyles(markers);
    });
  });
}

function updateMarkerStyles(markers) {
  markers.forEach(function(marker) {
    if (marker.selected) {
      marker.setStyle({
        color: '#eb8117',
        fillColor: '#f03',
      });
    } else {
      marker.setStyle({
        color: 'blue',
        fillColor: '#30f',
      });
    }
  });
  console.log("updateMarkerStyle", markersSelected.value, markers.filter(d => d.selected).map(d => d.siteID))
}

let markers = addMarkers(VA_data);
addClickListenersToMarkers(markers);
let markersSelected = Mutable([initialSite]);
updateMarkerStyles(markers);
return {addMarkers,addClickListenersToMarkers,updateMarkerStyles,markers,markersSelected};
}});

define({id: "01ba4719", body: () => {

}});

define({id: "6360fa26", inputs: ["selectSites","markers","markersSelected","updateMarkerStyles"], body: (selectSites,markers,markersSelected,updateMarkerStyles) => {
//////////////////////////////////////////////
// Event listener for site dropdown updates //
//////////////////////////////////////////////

selectSites.addEventListener('change', function() {
  let selectedSite = this.value;
  console.log("selectSites event", selectedSite)

  markers.forEach(function(marker) {
    if (selectedSite.includes(marker.siteID)) {
      marker.selected = true;
    } else {
      marker.selected = false;
    }
  });

  markersSelected.value = markers.filter(d => d.selected).map(d => d.siteID);
  updateMarkerStyles(markers);
});
}});

define({id: "3f405064", inline: true, inputs: ["selectSites","display"], body: async (selectSites,display) => {
display(await(
selectSites
))
}});

define({id: "c57b73e1", inline: true, inputs: ["selectYears","display"], body: async (selectYears,display) => {
display(await(
selectYears
))
}});

define({id: "5d5bdc22", inline: true, inputs: ["selectSeasons","display"], body: async (selectSeasons,display) => {
display(await(
selectSeasons
))
}});

define({id: "7470248a", inline: true, inputs: ["selectAggregators","display"], body: async (selectAggregators,display) => {
display(await(
selectAggregators
))
}});

define({id: "e498e252", inline: true, inputs: ["showAWLines","display"], body: async (showAWLines,display) => {
display(await(
showAWLines
))
}});

define({id: "f5b68d5d", inputs: ["selectedAggregators","dtFiltered","dtYDAYFiltered","dtYDAY_Week_Filtered","dtYDAY_Month_Filtered"], outputs: ["getAggregatedData","aggregatedData"], body: async (selectedAggregators,dtFiltered,dtYDAYFiltered,dtYDAY_Week_Filtered,dtYDAY_Month_Filtered) => {
const {getAggregatedData} = await import("./_import/components/variables.3a13d9f2.js");
const aggregatedData = getAggregatedData(selectedAggregators, dtFiltered, dtYDAYFiltered, dtYDAY_Week_Filtered, dtYDAY_Month_Filtered)
return {getAggregatedData,aggregatedData};
}});

define({id: "69a92002", inputs: ["plotAirWater","aggregatedData","selectedShowAWLines","display"], body: async (plotAirWater,aggregatedData,selectedShowAWLines,display) => {
display(await(
plotAirWater(aggregatedData, selectedShowAWLines)
))
}});

define({id: "01ba4719-1", body: () => {

}});

define({id: "d128e9cf", inline: true, inputs: ["showWater","display"], body: async (showWater,display) => {
display(await(
showWater
))
}});

define({id: "0594f988", inline: true, inputs: ["showAir","display"], body: async (showAir,display) => {
display(await(
showAir
))
}});

define({id: "ea12d0df", inline: true, inputs: ["facetYearly","display"], body: async (facetYearly,display) => {
display(await(
facetYearly
))
}});

define({id: "bf2ecf7a", inputs: ["view","plotTimeSeries","dtFiltered","groupSiteID","selectedShowWater","selectedShowAir","selectedFacetYearly"], outputs: ["timeSeriesHover"], body: (view,plotTimeSeries,dtFiltered,groupSiteID,selectedShowWater,selectedShowAir,selectedFacetYearly) => {
const timeSeriesHover = view(plotTimeSeries(dtFiltered, groupSiteID, selectedShowWater, selectedShowAir, selectedFacetYearly));
return {timeSeriesHover};
}});

define({id: "d796e1e7", body: () => {
//display(timeSeriesHover)
}});

define({id: "dd65b1c4", inputs: ["plotCurveHover","dtHOUR","dtHOUR_params_pred","timeSeriesHover","groupSiteID","display"], body: async (plotCurveHover,dtHOUR,dtHOUR_params_pred,timeSeriesHover,groupSiteID,display) => {
display(await(
plotCurveHover(dtHOUR, dtHOUR_params_pred, timeSeriesHover, groupSiteID)
))
}});

define({id: "225b9726", inline: true, inputs: ["selectPValue","display"], body: async (selectPValue,display) => {
display(await(
selectPValue
))
}});

define({id: "59c55df9", inline: true, inputs: ["selectAbsMinMax","display"], body: async (selectAbsMinMax,display) => {
display(await(
selectAbsMinMax
))
}});

define({id: "54e2ae3a", inline: true, inputs: ["selectRSAir","display"], body: async (selectRSAir,display) => {
display(await(
selectRSAir
))
}});

define({id: "e9a87053", inline: true, inputs: ["selectRSWater","display"], body: async (selectRSWater,display) => {
display(await(
selectRSWater
))
}});

define({id: "3adfee82", inputs: ["plotPhaseAmp","dtHOUR_ampPhase_Filtered","display"], body: async (plotPhaseAmp,dtHOUR_ampPhase_Filtered,display) => {
display(await(
plotPhaseAmp(dtHOUR_ampPhase_Filtered)
))
}});

define({id: "5bbca7e1", inputs: ["plotPhaseAmpXY","dtHOUR_ampPhase_Filtered","years","display"], body: async (plotPhaseAmpXY,dtHOUR_ampPhase_Filtered,years,display) => {
display(await(
plotPhaseAmpXY(dtHOUR_ampPhase_Filtered, years)
))
}});

define({id: "899fa960", inline: true, inputs: ["view","selectYdays"], body: (view,selectYdays) => {
view(selectYdays)
}});

define({id: "f725d924", inputs: ["display","dtHOURFiltered"], body: (display,dtHOURFiltered) => {
display(dtHOURFiltered)
}});

define({id: "13f011fc", inputs: ["plotCurve","dtHOURFiltered","display"], body: async (plotCurve,dtHOURFiltered,display) => {
display(await(
plotCurve(dtHOURFiltered)
))
}});

define({id: "923f3ecb", inputs: ["display","VA_data"], body: (display,VA_data) => {
display(VA_data)
}});

define({id: "43825114", inputs: ["display","dtFiltered"], body: (display,dtFiltered) => {
display(dtFiltered)
}});

define({id: "72392026", inputs: ["display","dtHOUR_ampPhase_Filtered"], body: (display,dtHOUR_ampPhase_Filtered) => {
display(dtHOUR_ampPhase_Filtered)
}});

define({id: "315d5d2c", inputs: ["Inputs","dtFiltered","display"], body: async (Inputs,dtFiltered,display) => {
display(await(
Inputs.table(dtFiltered)
))
}});

define({id: "ca866eea", inputs: ["display"], outputs: ["date","value","start","end"], body: (display) => {
/*
Inputs.table(samples, {
  format: {
    date: (x) => new Date(x).toISOString().slice(0, 10)
  }
})
*/
const date = [];
const value = [];
const start = new Date("2022-01-01");
const end = new Date("2023-01-01");
for (let currentValue = 0, currentDate = start; currentDate < end; ) {
  date.push(currentDate);
  value.push(currentValue);
  (currentDate = new Date(currentDate)), currentDate.setUTCDate(currentDate.getUTCDate() + 1);
  currentValue += Math.random() - 0.5;
}
display({date, value})
return {date,value,start,end};
}});

define({id: "3cae6d4d", body: () => {
//display(data)

}});

define({id: "c16cdcec", body: () => {
/*

//import * as Arrow from "apache-arrow";
import { Table, Schema, Field, Float32 } from "apache-arrow";

import * as Parquet from "parquet-wasm";
// Convert the JSON object to an array of objects if it's not already one
//const data = Array.isArray(dt) ? dt : [dt];

//const table = Arrow.Table.from(data);

// Generate a daily random walk as parallel arrays of {date, value}.

const data = {
  //siteID: dt.map(d => d.siteID),
  //dateTime: dt.map(d => d.dateTime),
  waterTemperature: dt.map(d => d.waterTemperature)
}

// Define the schema
const schema0 = new Arrow.Schema({
  fields: [
    //Arrow.Field.new({ name: 'siteID', type: new Arrow.Int32() }),
    //Arrow.Field.new({ name: 'dateTime', type: new Arrow.TimestampMillisecond() }),
    Arrow.Field.new({ name: 'waterTemperature', type: new Arrow.Float32() })
  ]
});

const schema = new Schema([
  //new Field('siteID', new Int32()),
  //new Field('dateTime', new TimestampMillisecond()),
  new Field('waterTemperature', new Float32())
]);

const table = Table.from([schema, data]);

// Output the Apache Arrow table as a Parquet table to standard out.
const parquetTable = Parquet.Table.fromIPCStream(Arrow.tableToIPC(table, "stream"));
const parquetBuilder = new Parquet.WriterPropertiesBuilder().setCompression(Parquet.Compression.ZSTD).build();
const parquetData = Parquet.writeParquet(parquetTable, parquetBuilder);


*/
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Temperature Data Viewer</a></li>
  </ol>
  <div id="observablehq-search"><input type="search" placeholder="Search"></div>
  <div id="observablehq-search-results"></div>
  <script>{const o=document.querySelector("#observablehq-search");o.setAttribute("data-shortcut",`${/Mac|iPhone/.test(navigator.platform)?"\u2318":"Alt-"}K`);const t=o.querySelector("input"),r=()=>import("./_observablehq/search.js");t.addEventListener("focus",r,{once:!0}),t.addEventListener("keydown",r,{once:!0});const c=document.querySelector("#observablehq-sidebar-toggle");addEventListener("keydown",e=>{(e.code==="KeyK"&&e.metaKey&&!e.altKey&&!e.ctrlKey||e.key==="/"&&!e.metaKey&&!e.altKey&&!e.ctrlKey&&e.target===document.body)&&(c.checked?t.focus():(c.click(),t.focus(),c.click()),t.select(),e.preventDefault())});}</script>
  <ol>
    <section class="observablehq-section-active">
      <summary>Chapters</summary>
      <ol>
    <li class="observablehq-link observablehq-link-active"><a href="./temperatureData.html">Temperature</a></li>
    <li class="observablehq-link"><a href="./temperatureFlowData.html">Flow and temperature</a></li>
      </ol>
    </section>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#raw-data-summary">Raw data summary</a></li>
<li class="observablehq-secondary-link"><a href="#filter-the-dataset">Filter the dataset</a></li>
<li class="observablehq-secondary-link"><a href="#plot-air%2Fwater-temperature">Plot air/water temperature</a></li>
<li class="observablehq-secondary-link"><a href="#plot-time-series">Plot time series</a></li>
<li class="observablehq-secondary-link"><a href="#plot-phase-difference-and-amplitude-ratio">Plot phase difference and amplitude ratio</a></li>
<li class="observablehq-secondary-link"><a href="#plot-hourly-data">Plot hourly data</a></li>
<li class="observablehq-secondary-link"><a href="#datasets">Datasets</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div id="cell-48a9579a" class="observablehq observablehq--block"></div>
<div id="cell-a6c004ae" class="observablehq observablehq--block"></div>
<div id="cell-58d644e3" class="observablehq observablehq--block"></div>
<div id="cell-a0e1eeed" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<p>The dataset for exploration here is from Shenandoah National Park.<br>
During development of this application, the dataset is limited to just the thtop and the bottom site for each area ["PA_01FL", "PA_06FL", "PA_10FL", "PI_01FL", "PI_06FL", "PI_10FL", "SR_01FL", "SR_06FL", "SR_10FL"] sites to deal with large file sizes with the whole dataset.<br>
Eventually, we will likely store the data in <strong>parquet files</strong> and use <strong>duckDB</strong> which can drastically limit file sizes and run times.</p>
<h2 id="raw-data-summary" tabindex="-1"><a class="observablehq-header-anchor" href="#raw-data-summary">Raw data summary</a></h2>
<div class="grid grid-cols-4">
  <div class="card">
    <h2>Total number of observations</h2>
    <span class="big"><span id="cell-d44a9786"><span class="observablehq-loading"></span></span></span>
  </div>
  <div class="card">
    <h2>Number of water temp observations</h2>
    <span class="big"><span id="cell-18682c05"><span class="observablehq-loading"></span></span></span>
  </div>
  <div class="card">
    <h2>Number of air temp observations</h2>
    <span class="big"><span id="cell-29505eb2"><span class="observablehq-loading"></span></span></span>
  </div>
</div>
<hr>
<h2 id="filter-the-dataset" tabindex="-1"><a class="observablehq-header-anchor" href="#filter-the-dataset">Filter the dataset</a></h2>
<p>Filter by sites, years and seasons. Use either the map or the dropdown to select sites.<br>
Click on a site marker to select or unselect a site. Selected sites will be <span style="color:#eb8117;"><em>orange</em></span>.<br>
All sites are on the map, but only these sites ["PA_01FL", "PA_06FL", "PA_10FL", "PI_01FL", "PI_06FL", "PI_10FL", "SR_01FL", "SR_06FL", "SR_10FL"] are included in the data for now.</p>
<div class="grid grid-cols-4">
  <div class="card grid-colspan-3">
    <span id="cell-51aeabef"><span class="observablehq-loading"></span></span>
  </div>
  <div class="grid grid-rows-4">
    <div class="card grid-colspan-1">
      <h2>Number of filtered observations</h2>
      <span class="big"><span id="cell-8d9103ef"><span class="observablehq-loading"></span></span></span>
    </div>
    <div class="card grid-colspan-1">
      <h2>Number of selected sites</h2>
      <span class="big"><span id="cell-f60bbe75"><span class="observablehq-loading"></span></span></span>
    </div>
    <div class="card grid-colspan-1">
      <h2>Number of selected years</h2>
      <span class="big"><span id="cell-bc09e940"><span class="observablehq-loading"></span></span></span>
    </div>
    <div class="card grid-colspan-1">
      <h2>Number of selected seasons</h2>
      <span class="big"><span id="cell-8faaaddf"><span class="observablehq-loading"></span></span></span>
    </div>
  </div>
</div>
<div id="cell-37f397cd" class="observablehq observablehq--block"></div>
<div id="cell-9cd086a7" class="observablehq observablehq--block"></div>
<div id="cell-f581ce20" class="observablehq observablehq--block"></div>
<div id="cell-cacb8bdc" class="observablehq observablehq--block"></div>
<div id="cell-01ba4719" class="observablehq observablehq--block"></div>
<div id="cell-6360fa26" class="observablehq observablehq--block"></div>
<div class="grid grid-cols-4">
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-3f405064"><span class="observablehq-loading"></span></span>
  </div>
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-c57b73e1"><span class="observablehq-loading"></span></span>
  </div>
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-5d5bdc22"><span class="observablehq-loading"></span></span>
  </div>
</div>
<p><em>Color-code map dots by phaseDiff and amplitudeRatio metrics(?). Will metrics need to be standardized across broad region?</em><br>
<em>Could add crossfilter for temp raw data and link with map to show sites that meet temperature criteria - this may be a different enough function that it goes in a separate page.</em></p>
<hr>
<h2 id="plot-air%2Fwater-temperature" tabindex="-1"><a class="observablehq-header-anchor" href="#plot-air%2Fwater-temperature">Plot air/water temperature</a></h2>
<div class="grid grid-cols-4"> 
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-7470248a"><span class="observablehq-loading"></span></span>
  </div>
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-e498e252"><span class="observablehq-loading"></span></span>
  </div>
</div>
<div id="cell-f5b68d5d" class="observablehq observablehq--block"></div>
<div id="cell-69a92002" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<div id="cell-01ba4719-1" class="observablehq observablehq--block"></div>
<hr>
<h2 id="plot-time-series" tabindex="-1"><a class="observablehq-header-anchor" href="#plot-time-series">Plot time series</a></h2>
<div class="grid grid-cols-2"> 
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-d128e9cf"><span class="observablehq-loading"></span></span>
    <span id="cell-0594f988"><span class="observablehq-loading"></span></span>
    <span id="cell-ea12d0df"><span class="observablehq-loading"></span></span>
  </div>
</div>
<p>Mouse over the time series chart below to see the hourly chart for the chosen site, year, and day of year.<br>
In the sub-daily graph, water temperature is in site-specific color and air temperature is grey. Predictions are the smooth lines.</p>
<div id="cell-bf2ecf7a" class="observablehq observablehq--block"></div>
<div id="cell-d796e1e7" class="observablehq observablehq--block"></div>
<div id="cell-dd65b1c4" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<p><em>Could add capability to add days to the graph by clicking, but the graph would get confusing quickly. See <a href="./raw_data.html#plot-hourly-data">Plot Hourly Data</a> section for an alternative.</em></p>
<hr>
<h2 id="plot-phase-difference-and-amplitude-ratio" tabindex="-1"><a class="observablehq-header-anchor" href="#plot-phase-difference-and-amplitude-ratio">Plot phase difference and amplitude ratio</a></h2>
<p>Filter the graphs for curve fit statistics. Default filter values are set to show all data.<br>
Use the <code>ABC filter</code> in the first column to filter based on the larger p-value of the 3 ABC paramters for both the <em>air</em> and <em>water</em> temperature models in the sin-cos curve fit for each day. <em>Will probably lose this as r-square may make more sense as a filter</em>.<br>
Use the <code>Select maximum absolute Phase Difference for plotting</code> filter in the first column to select the maximum absolute value for phase difference for plotting. This is brute force filtering.<br>
Use the <code>r-square</code> filters in the second column to filter based on r-square values for either the <em>air</em> or <em>water</em> temperature models or both.</p>
<div class="grid grid-cols-3">
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-225b9726"><span class="observablehq-loading"></span></span>
    <span id="cell-59c55df9"><span class="observablehq-loading"></span></span>
  </div>
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-54e2ae3a"><span class="observablehq-loading"></span></span>
    <span id="cell-e9a87053"><span class="observablehq-loading"></span></span>
  </div>
</div>
<div id="cell-3adfee82" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<div id="cell-5bbca7e1" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<hr>
<h2 id="plot-hourly-data" tabindex="-1"><a class="observablehq-header-anchor" href="#plot-hourly-data">Plot hourly data</a></h2>
<p>This is likely redundant with the time series clickable graph above.<br>
<em>Leaving in for now.</em><br>
<em>Could add 2nd y-axis for airTemp so the lines are spread out more.</em></p>
<div class="grid grid-cols-4"> 
  <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <span id="cell-899fa960"><span class="observablehq-loading"></span></span>
  </div>
</div>
<div id="cell-f725d924" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<div id="cell-13f011fc" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<p><em>Could standardize air and water temperature so we can see variation in the water temperature and how it lines up or not with the air temperature</em></p>
<hr>
<h2 id="datasets" tabindex="-1"><a class="observablehq-header-anchor" href="#datasets">Datasets</a></h2>
<p>Site data:</p>
<div id="cell-923f3ecb" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<hr>
<p>Filtered water/air temp object:</p>
<div id="cell-43825114" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<hr>
<p>Filtered phase difference/amplitude ratio object:</p>
<div id="cell-72392026" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<hr>
<p>Table of filtered data:</p>
<div id="cell-315d5d2c" class="observablehq observablehq--block"><span class="observablehq-loading"></span></div>
<p>Parquet playground - ignore</p>
<div id="cell-ca866eea" class="observablehq observablehq--block"></div>
<div id="cell-3cae6d4d" class="observablehq observablehq--block"></div>
<div id="cell-c16cdcec" class="observablehq observablehq--block"></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./"><span>Temperature Data Viewer</span></a><a rel="next" href="./temperatureFlowData.html"><span>Flow and temperature</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-05-28T11:50:47">May 28, 2024</a>.</div>
</footer>
</div>
